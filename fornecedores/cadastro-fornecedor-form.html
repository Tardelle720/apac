<!doctype html>
<html lang="pt-BR">
<head>
	<meta charset="utf-8" />
	<title>Cadastro de Fornecedor</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<style>
		body{font-family: Arial, sans-serif; padding:20px}
		form{max-width:600px}
		label{display:block;margin-top:12px;font-weight:600}
		input[type=text], select{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px}
		button{margin-top:14px;padding:10px 14px;border-radius:4px;border:none;background:#1976d2;color:#fff;cursor:pointer}
		button:disabled{opacity:0.6;cursor:not-allowed}
		.msg{margin-top:12px}
	</style>
</head>
<body>
	<h1>Cadastro de Fornecedor</h1>

	<form id="fornecedorForm">
		<label for="nome">Nome</label>
		<input id="nome" name="nome" type="text" required />

		<label for="tipo_documento">Tipo de Documento</label>
		<select id="tipo_documento" name="tipo_documento" required>
			<option value="">-- selecione --</option>
			<option value="1">CPF</option>
			<option value="2">CNPJ</option>
		</select>

		<label for="documento">Documento</label>
		<input id="documento" name="documento" type="text" required />

		<label for="endereco">Endereço</label>
		<input id="endereco" name="endereco" type="text" required />

		<button type="submit" id="submitBtn">Salvar</button>
		<button type="button" id="resetBtn" style="background:#9e9e9e;margin-left:8px">Limpar</button>
	</form>

	<div id="status" class="msg" role="status" aria-live="polite"></div>

	<script>
	const BASE = 'http://localhost/backend/public/fornecedores';

	const form = document.getElementById('fornecedorForm');
	const submitBtn = document.getElementById('submitBtn');
	const resetBtn = document.getElementById('resetBtn');
	const statusEl = document.getElementById('status');

	resetBtn.addEventListener('click', () => {
		form.reset();
		setStatus('', false);
	});

	form.addEventListener('submit', async (ev) => {
		ev.preventDefault();
		setStatus('', false);

		const nome = document.getElementById('nome').value.trim();
		const tipo = document.getElementById('tipo_documento').value;
		const documento = document.getElementById('documento').value.trim();
		const endereco = document.getElementById('endereco').value.trim();

		// validação mínima
		if (!nome || !tipo || !documento || !endereco) {
			setStatus('Preencha todos os campos.', true);
			return;
		}

		if (!['1','2'].includes(tipo)) {
			setStatus('Tipo de documento inválido.', true);
			return;
		}

		const payload = {
			nome: nome,
			tipo_documento: Number(tipo),
			documento: documento,
			endereco: endereco
		};

		submitBtn.disabled = true;
		const originalText = submitBtn.textContent;
		submitBtn.textContent = 'Enviando...';

		try {
			const res = await fetch(BASE, {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(payload)
			});

			if (res.ok) {
				setStatus('Fornecedor cadastrado com sucesso.', false);
				form.reset();
			} else {
				let text = await res.text().catch(() => res.statusText);
				try {
					const json = await res.json().catch(()=>null);
					if (json && json.message) text = json.message;
				} catch(e){}
				throw new Error('Erro: ' + res.status + ' - ' + text);
			}
		} catch (err) {
			setStatus(err.message || 'Falha ao enviar.', true);
			console.error(err);
		} finally {
			submitBtn.disabled = false;
			submitBtn.textContent = originalText;
		}
	});

	function setStatus(msg, isError) {
		statusEl.textContent = msg;
		statusEl.style.color = isError ? '#b00020' : '#133';
	}
	</script>
</body>
</html>

